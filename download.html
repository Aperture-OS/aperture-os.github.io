<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
    />
    <title>Download ApertureOS</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Sansation&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <link rel="icon" type="image/svg+xml" href="assets/icons/favicon.svg" />
  </head>
  <body>
    <!-- Header injected by header.js -->

    <main>
      <section id="download">
        <h1>Download ApertureOS</h1>
        <p>
          Download the stable version, or try the Nightly Version to experience
          the latest features.
        </p>

        <div class="downloads">
          <a href="unreleased.html" class="btn">Stable (ALPHA v0.0.0)</a>
          <a href="unreleased.html" class="btn">Nightly</a>
          <a href="https://github.com/Aperture-OS" class="btn"
            >Source (Github)</a
          >
        </div>

        <!-- SHA256 Check -->
        <section>
          <h2>Verify Your Download</h2>
          <p>Select your downloaded ISO file to compute its SHA256 hash:</p>
          <div class="file-upload-wrapper">
            <input type="file" id="fileInput" />
            <label for="fileInput" class="btn">Select ISO to Verify</label>
          </div>

          <div id="hashCheck" style="margin-top: 1rem">
            <p id="yourHash">Your hash: Upload file first.</p>
            <p id="correctHash">
              Correct hash:
              <span id="expectedHash"
                >Unknown yet. ApertureOS is not released.</span
              >
            </p>
            <p id="matchResult">File match: Upload file first.</p>
          </div>
        </section>

        <!-- Installation Guide -->
        <section id="guide" class="guide">
          <h2>Installation Guide</h2>
          <p style="font-weight: 1000">
            <strong>Follow these steps to safely install ApertureOS:</strong>
          </p>
          <br />

          <ol>
            <li>
              <strong>Prepare a USB Drive:</strong>
              <ul>
                <li>Use a USB drive with at least 4 GB of Storage.</li>
                <li>
                  Backup any important files â€“
                  <strong style="font-weight: bolder"
                    >USB will be formatted.</strong
                  >
                </li>
                <br />
              </ul>
            </li>

            <li>
              <strong>Write the ISO to USB:</strong>
              <p>Use one of the following tools:</p>
              <ul>
                <li>
                  <strong>Rufus (Windows):</strong> Select the ISO, choose your
                  USB, and click "Start".
                </li>
                <li>
                  <strong>Balena Etcher (Windows/Linux/macOS):</strong> Select
                  the ISO, select the USB, and flash.
                </li>
                <li>
                  <strong>[Advanced] Linux dd command:</strong>
                  <div class="code-block">
                    <button class="copy-btn" onclick="copyCode('ddCommand')">
                      Copy
                    </button>
                    <div class="code-wrapper">
                      <pre><code id="ddCommand">sudo dd if=/path/to/apertureos.iso of=/dev/sdX bs=8M status=progress</code></pre>
                    </div>
                  </div>
                  <p id="copyFeedback" class="copy-feedback"></p>

                  <br />Replace <code>/dev/sdX</code> with your USB drive
                  identifier, and /path/to/apertureos.iso with the path to the
                  downloaded ISO file. Make sure to double-check the drive
                  identifier to avoid data loss! (you can use <code>lsblk</code> to list drives.)
                </li>
                <br />
              </ul>
            </li>

            <li>
              <strong>Boot from USB:</strong>
              <ul>
                <li>Insert the USB into your computer.</li>
                <li>Restart and enter the BIOS/UEFI boot menu.</li>
                <li>Select the USB drive to boot from.</li>
                <br />
              </ul>
            </li>

            <li>
              <strong>Install ApertureOS:</strong>
              <ul>
                <li>
                  Follow the user-intuitive design of the Aperture OS Installer,
                  Pulse.
                </li>
                <li>
                  If you're having troubles with the installation open a support
                  thread in our
                  <a href="https://discord.gg/rx82u93hGD">Discord Server</a>.
                  Our wonderful community will help you as soon as possible!
                </li>
                <br />
              </ul>
            </li>

            <li>
              <strong>Post-Installation Setup:</strong>
              <ul>
                <li>Reboot into your new ApertureOS System.</li>
                <li>
                  Update your system using
                  <div class="code-block">
                    <div class="code-wrapper">
                      <pre><code id="ddCommand">sudo blink update</code></pre>
                    </div>
                  </div>
                  
                </li>
                <li>Install additional software or drivers as needed. Follow the documentations for more informations.</li>
                <br />
              </ul>
            </li>
          </ol>

          <p class="cloakNotice">
            <strong>IMPORTANT!</strong> Always verify the ISO hash before
            installation to ensure the file is intact and not corrupted.
          </p>
        </section>
      </section>
    </main>

    <script src="footer.js" defer></script>

    <script src="header.js" defer></script>
    <script>
      const expectedHash = document
        .getElementById("expectedHash")
        .textContent.trim();

      async function computeSHA256(file) {
        const arrayBuffer = await file.arrayBuffer();
        const hashBuffer = await crypto.subtle.digest("SHA-256", arrayBuffer);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        return hashArray.map((b) => b.toString(16).padStart(2, "0")).join("");
      }

      document
        .getElementById("fileInput")
        .addEventListener("change", async (event) => {
          const file = event.target.files[0];
          if (!file) return;

          const hash = await computeSHA256(file);
          document.getElementById(
            "yourHash"
          ).textContent = `Your hash: ${hash}`;
          document.getElementById(
            "correctHash"
          ).textContent = `Correct hash: ${expectedHash}`;

          if (hash === expectedHash) {
            document.getElementById("matchResult").textContent =
              "File match: File is intact, You can proceed with ISO to USB creation.";
            document.getElementById("matchResult").style.color = "#8aa8ff";
          } else {
            document.getElementById("matchResult").textContent =
              "File match: Damaged or corrupted! Re-download the file.";
            document.getElementById("matchResult").style.color = "#de3f31";
          }
        });
    </script>

    <script>
      function copyCode(codeId) {
        const code = document.getElementById(codeId).textContent;
        const feedback = document.getElementById("copyFeedback");

        // Try modern clipboard API
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard
            .writeText(code)
            .then(() => {
              feedback.textContent = "Copied to clipboard!";
              setTimeout(() => (feedback.textContent = ""), 2000);
            })
            .catch((err) => fallbackCopy(code, feedback));
        } else {
          fallbackCopy(code, feedback);
        }
      }

      function fallbackCopy(text, feedback) {
        const textarea = document.createElement("textarea");
        textarea.value = text;
        textarea.style.position = "fixed"; // prevent scroll jump
        textarea.style.opacity = "0"; // hide it
        document.body.appendChild(textarea);
        textarea.focus();
        textarea.select();

        try {
          document.execCommand("copy");
          feedback.textContent = "Copied to clipboard!";
        } catch (err) {
          feedback.textContent = "Failed to copy!";
          console.error("Fallback copy failed", err);
        }

        document.body.removeChild(textarea);
        setTimeout(() => (feedback.textContent = ""), 2000);
      }
    </script>
  </body>
</html>
